# 艺人管理系统 - 0.1.4版本更新计划

## 一、版本信息
- **当前版本**: 0.1.3
- **目标版本**: 0.1.4
- **迭代主题**: 艺人行程管理系统
- **开发周期**: 7天
- **开始时间**: 2026-01-05
- **结束时间**: 2026-01-11

## 二、迭代目标

基于艺人行程管理需求，实现完整的行程管理功能，包括：

1. ✅ 项目与活动时间范围管理
2. ✅ 艺人行程自动生成
3. ✅ 艺人行程冲突检测
4. ✅ 艺人行程详情展示
5. ✅ 月度行程日历视图
6. ✅ 行程冲突提示机制

## 三、详细开发计划

### 3.1 数据库准备（Day 1，1天）

| 任务编号 | 任务描述 | 负责人 | 完成标准 |
|---------|---------|--------|----------|
| 1.1     | 为projects表添加时间范围字段 | 后端开发 | 成功添加start_date和end_date字段 |
| 1.2     | 为activities表添加时间范围字段 | 后端开发 | 成功添加start_date和end_date字段 |
| 1.3     | 为artist_projects表添加行程信息 | 后端开发 | 成功添加schedule_info字段 |
| 1.4     | 为artist_activities表添加行程信息 | 后端开发 | 成功添加schedule_info字段 |
| 1.5     | 创建行程冲突检测逻辑 | 后端开发 | 能检测艺人行程是否冲突 |

### 3.2 后端开发 - 行程管理基础功能（Day 2-3，2天）

| 任务编号 | 任务描述 | 负责人 | 完成标准 |
|---------|---------|--------|----------|
| 2.1     | 实现项目时间范围API | 后端开发 | 支持项目开始/结束时间的CRUD |
| 2.2     | 实现活动时间范围API | 后端开发 | 支持活动开始/结束时间的CRUD |
| 2.3     | 实现行程生成逻辑 | 后端开发 | 自动生成艺人行程信息 |
| 2.4     | 实现行程冲突检测API | 后端开发 | 能检测并返回行程冲突信息 |
| 2.5     | 实现艺人行程查询API | 后端开发 | 支持查询单个艺人的行程 |
| 2.6     | 实现月度行程查询API | 后端开发 | 支持按月份查询所有行程 |

### 3.3 后端开发 - 高级功能（Day 4，1天）

| 任务编号 | 任务描述 | 负责人 | 完成标准 |
|---------|---------|--------|----------|
| 3.1     | 实现行程冲突提示API | 后端开发 | 关联艺人时返回冲突信息 |
| 3.2     | 实现行程详情API | 后端开发 | 返回行程的详细信息 |
| 3.3     | 实现行程统计API | 后端开发 | 统计艺人行程占用情况 |
| 3.4     | 实现行程导出API | 后端开发 | 支持导出行程为Excel |

### 3.4 前端开发 - 页面实现（Day 5-6，2天）

| 任务编号 | 任务描述 | 负责人 | 完成标准 |
|---------|---------|--------|----------|
| 4.1     | 优化项目管理页面 | 前端开发 | 添加开始/结束时间字段 |
| 4.2     | 优化活动管理页面 | 前端开发 | 添加开始/结束时间字段 |
| 4.3     | 实现艺人行程详情页 | 前端开发 | 显示艺人行程列表和时间占用 |
| 4.4     | 实现行程管理页面 | 前端开发 | 月度日历视图，显示每日行程 |
| 4.5     | 实现行程冲突提示 | 前端开发 | 关联艺人时显示冲突提示 |
| 4.6     | 实现行程详情弹窗 | 前端开发 | 点击行程显示详细信息 |
| 4.7     | 集成行程导出功能 | 前端开发 | 支持导出行程为Excel |

### 3.5 测试与优化（Day 7，1天）

| 任务编号 | 任务描述 | 负责人 | 完成标准 |
|---------|---------|--------|----------|
| 5.1     | 功能测试 | 测试人员 | 所有行程功能正常工作 |
| 5.2     | 兼容性测试 | 测试人员 | 支持主流浏览器 |
| 5.3     | 性能测试 | 后端开发 | 接口响应时间<1秒 |
| 5.4     | 文档更新 | 后端开发 | 更新API文档和使用说明 |

## 四、技术实现细节

### 4.1 数据库表结构

#### 项目表更新 `projects`
```sql
-- 添加时间范围字段
ALTER TABLE projects ADD COLUMN start_date DATETIME DEFAULT NULL COMMENT '项目开始时间';
ALTER TABLE projects ADD COLUMN end_date DATETIME DEFAULT NULL COMMENT '项目结束时间';
```

#### 活动表更新 `activities`
```sql
-- 添加时间范围字段
ALTER TABLE activities ADD COLUMN start_date DATETIME DEFAULT NULL COMMENT '活动开始时间';
ALTER TABLE activities ADD COLUMN end_date DATETIME DEFAULT NULL COMMENT '活动结束时间';
```

#### 艺人项目关联表更新 `artist_projects`
```sql
-- 添加行程信息字段
ALTER TABLE artist_projects ADD COLUMN schedule_info JSON DEFAULT NULL COMMENT '行程信息';
```

#### 艺人活动关联表更新 `artist_activities`
```sql
-- 添加行程信息字段
ALTER TABLE artist_activities ADD COLUMN schedule_info JSON DEFAULT NULL COMMENT '行程信息';
```

### 4.2 API接口设计

| 接口路径 | 方法 | 功能描述 |
|---------|------|----------|
| `/api/projects/{project_id}/time-range` | PUT | 更新项目时间范围 |
| `/api/activities/{activity_id}/time-range` | PUT | 更新活动时间范围 |
| `/api/artists/{artist_id}/schedule` | GET | 获取艺人行程列表 |
| `/api/artists/{artist_id}/schedule/month` | GET | 获取艺人月度行程 |
| `/api/schedule/stats/{artist_id}` | GET | 获取艺人行程统计 |
| `/api/schedule/conflict-check` | POST | 检测行程冲突 |
| `/api/schedule/export/{artist_id}` | GET | 导出艺人行程 |
| `/api/schedule/monthly` | GET | 获取所有艺人月度行程 |

### 4.3 前端页面设计

1. **项目/活动管理页面**
   - 添加开始时间和结束时间字段
   - 支持日期时间选择器
   - 实时验证时间范围有效性

2. **艺人行程详情页**
   - 行程列表：显示项目/活动名称、时间范围
   - 时间轴视图：按时间顺序展示行程
   - 行程统计：显示行程占用率

3. **行程管理页面**
   - 月度日历视图：显示每天的活动和项目
   - 颜色区分：项目用蓝色，活动用绿色
   - 点击行程弹出详情窗口
   - 支持月份切换
   - 显示行程冲突标记

4. **行程冲突提示**
   - 关联艺人时实时检测冲突
   - 冲突时显示红色提示框
   - 显示冲突的具体时间和项目/活动
   - 提供冲突解决方案建议

## 五、测试计划

### 5.1 功能测试
- 项目/活动时间范围设置
- 艺人行程自动生成
- 行程冲突检测
- 月度行程展示
- 行程详情弹窗
- 行程冲突提示
- 行程导出功能

### 5.2 兼容性测试
- 主流浏览器：Chrome、Firefox、Safari、Edge
- 不同屏幕尺寸：桌面端、平板端
- 不同分辨率：1920x1080、1366x768、1440x900

### 5.3 性能测试
- 行程列表加载时间 < 1秒
- 月度行程渲染时间 < 1.5秒
- 行程冲突检测响应时间 < 0.5秒
- 并发请求处理能力：支持500并发

## 六、风险评估与应对措施

| 风险项 | 影响程度 | 应对措施 |
|-------|---------|----------|
| 数据库结构变更影响现有功能 | 高 | 做好数据备份，编写回滚脚本 |
| 行程冲突检测逻辑复杂 | 中 | 编写详细的测试用例，验证各种冲突场景 |
| 月度行程渲染性能问题 | 中 | 优化前端渲染逻辑，使用虚拟滚动 |
| 时间范围输入错误 | 低 | 添加前端验证，限制无效的时间范围 |
| 不同时区处理问题 | 中 | 统一使用UTC时间存储，前端显示本地时间 |

## 七、验收标准

1. ✅ 项目和活动支持设置时间范围
2. ✅ 艺人行程自动生成
3. ✅ 行程冲突检测准确无误
4. ✅ 月度行程日历视图正常显示
5. ✅ 行程详情弹窗功能正常
6. ✅ 行程冲突提示明显有效
7. ✅ 行程导出功能正常
8. ✅ 所有API响应时间<1秒
9. ✅ 支持主流浏览器
10. ✅ 代码符合项目规范

## 八、发布准备

1. **代码评审**：完成所有功能开发后，进行代码评审
2. **测试报告**：收集并整理测试报告，确保所有bug已修复
3. **文档更新**：更新API文档和使用说明
4. **部署计划**：制定详细的部署计划，包括数据库迁移脚本
5. **发布通知**：编写发布通知，告知用户新功能和变更
6. **备份数据**：发布前备份所有数据

## 九、后续迭代建议

1. 添加工程提醒功能，包括邮件、短信通知
2. 实现行程拖拽调整功能
3. 支持行程模板，快速创建相似行程
4. 添加工程资源管理，如场地、设备等
5. 实现团队行程视图，查看多个艺人的行程
6. 支持行程共享功能
7. 添加工程数据分析，如行程效率、资源利用率
8. 支持移动端适配

## 十、优化迭代方案与跨板块关联

### 10.1 当前计划的不足之处分析

| 不足点 | 详细说明 | 优化建议 |
|-------|---------|----------|
| 行程生成逻辑简单 | 缺少详细的行程生成规则和优先级处理 | 完善行程生成算法，考虑行程重要性、时间紧迫性、艺人偏好等因素 |
| 缺乏行程审批流程 | 对于重要行程，没有审批机制 | 添加行程审批功能，支持多级审批和自动通知 |
| 行程变更通知缺失 | 行程变更时没有通知相关人员 | 实现行程变更通知机制，支持多种通知方式 |
| 数据分析维度不足 | 行程统计API功能简单 | 丰富数据分析维度，如行程效率、资源利用率、冲突率等 |
| 移动端支持不足 | 仅在后续迭代中提及 | 提前考虑移动端适配，设计响应式界面 |
| 权限管理缺失 | 不同角色的行程管理权限不明确 | 添加基于角色的行程权限管理 |
| 与其他系统集成不足 | 缺乏与工单、艺人、活动、项目的深度关联 | 实现跨板块双向关联，形成完整的业务闭环 |

### 10.2 行程管理与各板块的双向关联

#### 10.2.1 行程管理 <-> 工单系统

| 关联方向 | 具体实现 | 业务价值 |
|---------|---------|----------|
| 工单 -> 行程 | 当工单需要艺人参与时，自动创建/关联行程 | 实现工单到行程的自动流转，提高工作效率 |
| 行程 -> 工单 | 行程变更时，自动更新相关工单状态和优先级 | 确保工单进度与行程同步，避免信息孤岛 |
| 双向查询 | 工单详情页显示相关行程信息；行程详情页显示相关工单 | 提供完整的业务上下文，便于决策 |
| 冲突处理 | 工单分配时检查艺人行程，避免冲突 | 减少冲突情况，提高资源利用率 |

#### 10.2.2 行程管理 <-> 艺人管理

| 关联方向 | 具体实现 | 业务价值 |
|---------|---------|----------|
| 艺人 -> 行程 | 艺人状态变更时，自动调整行程安排 | 确保行程与艺人实际状态匹配 |
| 行程 -> 艺人 | 行程安排自动更新艺人状态（忙碌/空闲） | 提供艺人实时可用性信息 |
| 艺人行程管理 | 艺人可以查看和申请修改自己的行程 | 提高艺人参与度和满意度 |
| 行程偏好设置 | 艺人可以设置行程偏好，影响行程生成 | 优化行程安排，提高艺人满意度 |

#### 10.2.3 行程管理 <-> 活动管理

| 关联方向 | 具体实现 | 业务价值 |
|---------|---------|----------|
| 活动 -> 行程 | 活动创建/修改时，自动生成/更新行程 | 确保活动与行程的一致性 |
| 行程 -> 活动 | 行程变更时，自动更新活动状态和时间 | 避免活动信息与行程脱节 |
| 双向查询 | 活动详情页显示相关行程；行程详情页显示相关活动 | 提供完整的活动-行程关联视图 |
| 活动资源关联 | 行程关联活动资源，如场地、设备等 | 确保资源与行程的协同安排 |

#### 10.2.4 行程管理 <-> 项目管理

| 关联方向 | 具体实现 | 业务价值 |
|---------|---------|----------|
| 项目 -> 行程 | 项目里程碑或任务需要艺人时，自动生成行程 | 确保项目进度与艺人行程同步 |
| 行程 -> 项目 | 行程变更时，自动更新项目计划和依赖关系 | 提高项目管理的准确性 |
| 双向查询 | 项目详情页显示相关行程；行程详情页显示相关项目 | 提供项目-行程的完整视图 |
| 资源冲突检测 | 项目分配时检查行程和资源冲突 | 减少项目资源冲突 |

#### 10.2.5 行程管理 <-> 管理员管理

| 关联方向 | 具体实现 | 业务价值 |
|---------|---------|----------|
| 管理员 -> 行程 | 管理员可以查看和管理所有艺人的行程 | 提供全局行程监控能力 |
| 行程 -> 管理员 | 重要行程变更时，自动通知管理员 | 确保管理员及时掌握行程动态 |
| 行程审批 | 管理员可以审批重要行程变更 | 加强行程管理的可控性 |
| 行程权限管理 | 管理员可以设置不同角色的行程权限 | 实现精细化的行程管理 |
| 行程数据分析 | 管理员可以查看行程统计和分析报告 | 支持数据驱动的决策 |

### 10.3 跨板块关联的技术实现

1. **统一的事件总线**：实现事件驱动架构，各系统通过事件总线进行通信
2. **共享的数据模型**：定义统一的行程数据模型，确保数据一致性
3. **API网关**：通过API网关实现各系统间的安全通信
4. **实时通知机制**：使用WebSocket或消息队列实现实时通知
5. **统一的权限管理**：基于角色的权限管理，控制不同角色的行程访问权限

### 10.4 业务流程优化

1. **工单驱动行程**：
   ```
   工单创建 → 检查艺人行程 → 生成/关联行程 → 通知相关人员 → 行程执行 → 更新工单状态
   ```

2. **活动/项目驱动行程**：
   ```
   活动/项目创建 → 设置时间范围 → 关联艺人 → 生成行程 → 检查冲突 → 通知相关人员 → 行程执行
   ```

3. **行程变更处理**：
   ```
   行程变更申请 → 审批（可选） → 更新行程 → 通知相关系统 → 更新相关工单/活动/项目 → 通知相关人员
   ```

### 10.5 预期效果

1. **提高工作效率**：自动化的行程生成和变更处理，减少手动操作
2. **减少冲突**：实时的冲突检测和提醒，降低资源冲突率
3. **信息同步**：各系统间的双向关联，确保信息一致性
4. **提高决策质量**：完整的业务上下文，支持数据驱动的决策
5. **增强用户体验**：统一的行程视图，便捷的行程管理功能
6. **提高可控性**：完善的审批和权限管理，加强行程管理的可控性

通过上述优化和跨板块关联，行程管理系统将不再是孤立的功能模块，而是与其他系统深度集成，形成完整的业务闭环，为艺人管理系统带来更大的价值。
